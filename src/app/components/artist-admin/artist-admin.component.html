<div class="admin-container">
  <!-- Header -->
  <header class="admin-header">
    <div class="header-content">
      <div class="artist-info">
        <div class="artist-avatar">
          <img [src]="getFileUrl(artist()?.profileImage)" [alt]="artist()?.name" />
        </div>
        <div>
          <h1>Artist Dashboard</h1>
          <p>{{ artist()?.name }}</p>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()">üö™</button>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="admin-nav">
    <button [class.active]="activeTab() === 'overview'" (click)="activeTab.set('overview')">
      <span>üìä</span> Overview
    </button>
    <button [class.active]="activeTab() === 'upload'" (click)="activeTab.set('upload')">
      <span>üì§</span> Upload Song
    </button>
    <button [class.active]="activeTab() === 'songs'" (click)="activeTab.set('songs')">
      <span>üéµ</span> My Songs
    </button>
    <button [class.active]="activeTab() === 'settings'" (click)="activeTab.set('settings')">
      <span>‚öôÔ∏è</span> Settings
    </button>
  </nav>

  <!-- Main Content -->
  <main class="admin-content">

    <!-- Overview Tab -->
    @if (activeTab() === 'overview') {
    <div class="overview-content">
      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon blue">üéµ</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">{{ stats()?.totalSongs || 0 }}</div>
          <div class="stat-label">Total Songs</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon purple">‚ñ∂Ô∏è</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">{{ formatNumber(stats()?.totalPlays || 0) }}</div>
          <div class="stat-label">Total Plays</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon green">‚è±Ô∏è</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">{{ formatDuration(stats()?.totalListeningHours || 0) }}</div>
          <div class="stat-label">Listening Hours</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon red">‚ù§Ô∏è</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">{{ formatNumber(stats()?.totalLikes || 0) }}</div>
          <div class="stat-label">Total Likes</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon orange">üåç</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">{{ formatNumber(stats()?.monthlyListeners || 0) }}</div>
          <div class="stat-label">Monthly Listeners</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-icon yellow">üí∞</div>
            <span class="trend up">üìà</span>
          </div>
          <div class="stat-value">${{ formatNumber(stats()?.revenue || 0) }}</div>
          <div class="stat-label">Total Revenue</div>
        </div>
      </div>

      <!-- Top Performing Songs -->
      <div class="top-songs-card">
        <h2>Top Performing Songs</h2>
        <div class="top-songs-list">
          @for (song of songs().slice(0, 5); track song.id; let i = $index) {
          <div class="top-song-item">
            <span class="rank">{{ i + 1 }}</span>
            <img [src]="getFileUrl(song.coverArt)" [alt]="song.title" />
            <div class="song-info">
              <span class="title">{{ song.title }}</span>
              <span class="album">{{ song.album?.title || 'Single' }}</span>
            </div>
            <div class="song-stats">
              <span class="plays">{{ formatNumber(song.totalPlays) }} plays</span>
              <span class="time">{{ song.totalListeningTime }}</span>
            </div>
          </div>
          }
          @empty {
          <p class="empty-text">No songs yet. Upload your first song!</p>
          }
        </div>
      </div>
    </div>
    }

    <!-- Upload Tab -->
    @if (activeTab() === 'upload') {
    <div class="upload-content">
      <div class="upload-card">
        <h2>Upload New Song</h2>
        <form (ngSubmit)="uploadSong()">
          <div class="form-grid">
            <div class="form-group">
              <label>Song Title *</label>
              <input type="text" [(ngModel)]="uploadForm.title" name="title" placeholder="Enter song title" required />
            </div>
            <div class="form-group">
              <label>Album Name</label>
              <input type="text" [(ngModel)]="uploadForm.albumName" name="albumName"
                placeholder="Enter album name (optional)" />
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Genre *</label>
              <select [(ngModel)]="uploadForm.genreId" name="genreId" required>
                <option value="">Select genre</option>
                @for (genre of genres(); track genre.id) {
                <option [value]="genre.id">{{ genre.name }}</option>
                }
              </select>
            </div>
            <div class="form-group">
              <label>Release Date</label>
              <input type="date" [(ngModel)]="uploadForm.releaseDate" name="releaseDate" />
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label>Pricing</label>
              <div class="pricing-toggle">
                <label class="toggle-label">
                  <input type="checkbox" [(ngModel)]="uploadForm.isFree" name="isFree" />
                  <span>Free content</span>
                </label>
              </div>
            </div>
            <div class="form-group" *ngIf="!uploadForm.isFree">
              <label>Price (USD) *</label>
              <input type="number" [(ngModel)]="uploadForm.price" name="price"
                placeholder="0.00" min="0.01" step="0.01" [required]="!uploadForm.isFree" />
            </div>
          </div>

          <div class="form-group">
            <label>Audio File *</label>
            <div class="file-upload">
              <input type="file" id="audio-upload" accept="audio/*" (change)="onAudioFileSelected($event)" required />
              <label for="audio-upload">
                <div class="upload-icon">üì§</div>
                <div class="upload-text">
                  <span class="primary">Click to upload audio file</span>
                  <span class="secondary">
                    {{ uploadForm.audioFile?.name || 'MP3, WAV, or FLAC (max. 100MB)' }}
                  </span>
                </div>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Cover Art</label>
            <div class="file-upload">
              <input type="file" id="cover-upload" accept="image/*" (change)="onCoverArtSelected($event)" />
              <label for="cover-upload">
                <div class="upload-icon">üñºÔ∏è</div>
                <div class="upload-text">
                  <span class="primary">Click to upload cover art</span>
                  <span class="secondary">
                    {{ uploadForm.coverArtFile?.name || 'JPG or PNG (recommended: 3000x3000px)' }}
                  </span>
                </div>
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="isUploading()">
              @if (isUploading()) {
              ‚è≥ Uploading...
              } @else {
              üì§ Upload Song
              }
            </button>
            <button type="button" class="btn-secondary" (click)="resetUploadForm()">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
    }

    <!-- My Songs Tab -->
    @if (activeTab() === 'songs') {
    <div class="songs-content">
      <div class="songs-header">
        <h2>My Songs ({{ songs().length }})</h2>
        <button class="btn-primary" (click)="activeTab.set('upload')">
          üì§ Upload New Song
        </button>
      </div>

      <div class="songs-table-card">
        <table class="songs-table">
          <thead>
            <tr>
              <th>Song</th>
              <th>Album</th>
              <th>Price</th>
              <th>Upload Date</th>
              <th class="right">Plays</th>
              <th class="right">Likes</th>
              <th class="right">Listening Time</th>
              <th class="right">Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (song of songs(); track song.id) {
            <tr>
              <td>
                <div class="song-cell">
                  <img [src]="getFileUrl(song.coverArt)" [alt]="song.title" />
                  <div>
                    <span class="title">{{ song.title }}</span>
                    <span class="duration">{{ song.duration }}</span>
                  </div>
                </div>
              </td>
              <td>{{ song.album?.title || 'Single' }}</td>
              <td>
                @if (song.isFree) {
                  <span class="badge free">Free</span>
                } @else {
                  <span class="badge paid">${{ song.price.toFixed(2) }}</span>
                }
              </td>
              <td>{{ formatDate(song.releaseDate) }}</td>
              <td class="right">{{ formatNumber(song.totalPlays) }}</td>
              <td class="right likes">{{ formatNumber(song.totalLikes) }}</td>
              <td class="right time">{{ song.totalListeningTime }}</td>
              <td class="right">
                <div class="actions">
                  <button class="action-btn" title="Edit">‚úèÔ∏è</button>
                  <button class="action-btn danger" title="Delete" (click)="deleteSong(song.id)">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
            }
            @empty {
            <tr>
              <td colspan="8" class="empty">No songs uploaded yet</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    }

    <!-- Settings Tab -->
    @if (activeTab() === 'settings') {
    <div class="settings-content">
      <!-- Profile Settings -->
      <div class="settings-card">
        <h2>Profile Settings</h2>

        <div class="profile-image-section">
          <label>Profile Picture</label>
          <div class="profile-image-row">
            <img [src]="getFileUrl(artist()?.profileImage)" [alt]="artist()?.name" class="profile-image" />
            <div>
              <input type="file" id="profile-image" accept="image/*" (change)="onProfileImageSelected($event)" />
              <label for="profile-image" class="btn-secondary">Change Photo</label>
              <p class="help-text">JPG or PNG. Max size 5MB.</p>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Artist Name</label>
          <input type="text" [(ngModel)]="settingsForm.name" name="name" />
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="settingsForm.email" name="email" disabled />
        </div>

        <div class="form-group">
          <label>Bio</label>
          <textarea [(ngModel)]="settingsForm.bio" name="bio" rows="4"
            placeholder="Tell fans about yourself..."></textarea>
        </div>
      </div>

      <!-- Account Security -->
      <div class="settings-card">
        <h2>Account Security</h2>

        <div class="form-group">
          <label>Current Password</label>
          <input type="password" [(ngModel)]="settingsForm.currentPassword" name="currentPassword"
            placeholder="Enter current password" />
        </div>

        <div class="form-group">
          <label>New Password</label>
          <input type="password" [(ngModel)]="settingsForm.newPassword" name="newPassword"
            placeholder="Enter new password" />
        </div>

        <div class="form-group">
          <label>Confirm New Password</label>
          <input type="password" [(ngModel)]="settingsForm.confirmPassword" name="confirmPassword"
            placeholder="Confirm new password" />
        </div>

        <button class="btn-secondary" (click)="updatePassword()">Update Password</button>
      </div>

      <!-- Save Button -->
      <div class="settings-actions">
        <button class="btn-secondary">Cancel</button>
        <button class="btn-primary" (click)="saveSettings()">üíæ Save Changes</button>
      </div>
    </div>
    }
  </main>
</div>