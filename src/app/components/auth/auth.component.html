<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <div class="logo">
        <span class="logo-icon">ðŸŽµ</span>
        <h1>Aganim</h1>
      </div>
      <p class="tagline">Your Personal Music Journey</p>
    </div>

    @if (mode() !== 'confirm') {
      <!-- User Type Toggle -->
      <div class="user-type-toggle">
        <button 
          [class.active]="userType() === 'user'"
          (click)="setUserType('user')"
        >
          <span class="icon">ðŸ‘¤</span>
          Listener
        </button>
        <button 
          [class.active]="userType() === 'artist'"
          (click)="setUserType('artist')"
        >
          <span class="icon">ðŸŽ¤</span>
          Artist
        </button>
      </div>

      <!-- Auth Mode Toggle -->
      <div class="auth-mode-toggle">
        <button 
          [class.active]="mode() === 'login'"
          (click)="setMode('login')"
        >
          Sign In
        </button>
        <button 
          [class.active]="mode() === 'register'"
          (click)="setMode('register')"
        >
          Sign Up
        </button>
      </div>
    }

    <!-- Success Display -->
    @if (success()) {
      <div class="success-message">
        {{ success() }}
      </div>
    }

    <!-- Error Display -->
    @if (error()) {
      <div class="error-message">
        {{ error() }}
      </div>
    }

    <form (ngSubmit)="onSubmit()" class="auth-form">
      @if (mode() === 'confirm') {
        <!-- Email Confirmation -->
        <div class="form-group">
          <label>Confirmation Code</label>
          <p class="help-text">We sent a code to {{ pendingEmail() }}</p>
          <input 
            type="text" 
            [(ngModel)]="confirmationCode"
            name="confirmationCode"
            placeholder="Enter 6-digit code"
            maxlength="6"
          />
        </div>
        <button type="submit" class="submit-btn" [disabled]="loading()">
          {{ loading() ? 'Verifying...' : 'Verify Email' }}
        </button>
        <button type="button" class="link-btn" (click)="resendCode()">
          Resend Code
        </button>
        <button type="button" class="link-btn" (click)="setMode('login')">
          Back to Login
        </button>
      } @else {
        <!-- Username / Name -->
        <div class="form-group">
          @if (mode() === 'login') {
            <label>{{ userType() === 'artist' ? 'Email' : 'Username' }}</label>
            <input 
              type="text" 
              [(ngModel)]="username"
              name="username"
              [placeholder]="userType() === 'artist' ? 'Enter your email' : 'Enter your username'"
            />
          } @else {
            <label>{{ userType() === 'artist' ? 'Artist Name' : 'Username' }} <span class="required">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="username"
              name="username"
              [placeholder]="userType() === 'artist' ? 'Enter artist name' : 'Enter username'"
              [class.input-error]="submitted && !username"
            />
            @if (submitted && !username) {
              <span class="field-error">{{ userType() === 'artist' ? 'Artist name' : 'Username' }} is required</span>
            } @else if (submitted && username.length < 3) {
              <span class="field-error">{{ userType() === 'artist' ? 'Artist name' : 'Username' }} must be at least 3 characters</span>
            }
          }
        </div>

        <!-- Email (only for registration) -->
        @if (mode() === 'register') {
          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input 
              type="email" 
              [(ngModel)]="email"
              name="email"
              placeholder="Enter email address"
              [class.input-error]="submitted && (!email || !isValidEmail(email))"
            />
            @if (submitted && !email) {
              <span class="field-error">Email is required</span>
            } @else if (submitted && email && !isValidEmail(email)) {
              <span class="field-error">Please enter a valid email address</span>
            }
          </div>
        }

        <!-- Password -->
        <div class="form-group">
          <label>Password @if (mode() === 'register') { <span class="required">*</span> }</label>
          <input 
            type="password" 
            [(ngModel)]="password"
            name="password"
            placeholder="Enter password"
            [class.input-error]="submitted && mode() === 'register' && (!password || password.length < 6)"
          />
          @if (mode() === 'register' && submitted && !password) {
            <span class="field-error">Password is required</span>
          } @else if (mode() === 'register' && submitted && password.length < 6) {
            <span class="field-error">Password must be at least 6 characters</span>
          }
        </div>

        <!-- Confirm Password (only for registration) -->
        @if (mode() === 'register') {
          <div class="form-group">
            <label>Confirm Password <span class="required">*</span></label>
            <input 
              type="password" 
              [(ngModel)]="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm password"
              [class.input-error]="submitted && (!confirmPassword || confirmPassword !== password)"
            />
            @if (submitted && !confirmPassword) {
              <span class="field-error">Please confirm your password</span>
            } @else if (submitted && confirmPassword && confirmPassword !== password) {
              <span class="field-error">Passwords do not match</span>
            }
          </div>

          <!-- Bio (only for artist registration) -->
          @if (userType() === 'artist') {
            <div class="form-group">
              <label>Bio (Optional)</label>
              <textarea 
                [(ngModel)]="bio"
                name="bio"
                placeholder="Tell us about yourself"
                rows="3"
              ></textarea>
            </div>
          }
        }

        <button type="submit" class="submit-btn" [disabled]="loading()">
          @if (loading()) {
            {{ mode() === 'login' ? 'Signing In...' : 'Creating Account...' }}
          } @else {
            {{ mode() === 'login' ? 'Sign In' : 'Create Account' }}
          }
        </button>
      }
    </form>
  </div>
</div>
